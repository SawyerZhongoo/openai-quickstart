(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(42603)}])},87766:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var l=r(85893);let a=e=>{let{handleClick:t,children:r}=e;return(0,l.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:r})};var n=a},5782:function(e,t,r){"use strict";r.a(e,async function(e,l){try{r.d(t,{e:function(){return C}});var a=r(85893),n=r(33111),s=r(51668),o=r(67294),i=r(86501),d=r(61162),c=r(17172),u=r(62716),m=r(97450),x=r(88990),p=r(79408),f=r(39817),h=r(79420),v=r(84378),g=r(11046),b=r(41347),y=r(10094),j=r(11085),w=r(33299),k=r(59227),N=e([f]);f=(N.then?(await N)():N)[0];let C=(0,o.memo)(e=>{let{stopConversationRef:t}=e,{t:r}=(0,d.$G)("chat"),{state:{selectedConversation:l,conversations:N,models:C,apiKey:S,pluginKeys:I,serverSideApiKeyIsSet:E,messageIsStreaming:Z,modelError:P,loading:_,prompts:O},handleUpdateConversation:T,dispatch:L}=(0,o.useContext)(x.Z),[D,A]=(0,o.useState)(),[z,G]=(0,o.useState)(!0),[K,R]=(0,o.useState)(!1),[M,U]=(0,o.useState)(!1),J=(0,o.useRef)(null),$=(0,o.useRef)(null),F=(0,o.useRef)(null),{data:H,status:B}=(0,w.useSession)(),Y=(0,k.Z)(),W=(0,o.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(l){var n,s,o,d,m,x;let p,f;if(r){let t=[...l.messages];for(let e=0;e<r;e++)t.pop();p={...l,messages:[...t,e]}}else p={...l,messages:[...l.messages,e]};L({field:"selectedConversation",value:p}),L({field:"loading",value:!0}),L({field:"messageIsStreaming",value:!0});let h={model:p.model,messages:p.messages,key:S,prompt:p.prompt,temperature:p.temperature,username:null==H?void 0:null===(n=H.user)||void 0===n?void 0:n.name,email:null==H?void 0:null===(s=H.user)||void 0===s?void 0:s.email,accessToken:Y},v=(0,c.O)(a);f=a?JSON.stringify({...h,googleAPIKey:null===(o=null===(d=I.find(e=>"google-search"===e.pluginId))||void 0===d?void 0:d.requiredKeys.find(e=>"GOOGLE_API_KEY"===e.key))||void 0===o?void 0:o.value,googleCSEId:null===(m=null===(x=I.find(e=>"google-search"===e.pluginId))||void 0===x?void 0:x.requiredKeys.find(e=>"GOOGLE_CSE_ID"===e.key))||void 0===m?void 0:m.value}):JSON.stringify(h);let g=new AbortController,b=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},signal:g.signal,body:f});if(!b.ok){L({field:"loading",value:!1}),L({field:"messageIsStreaming",value:!1}),i.ZP.error(b.statusText);return}let y=b.body;if(!y){L({field:"loading",value:!1}),L({field:"messageIsStreaming",value:!1});return}if(fetch("api/metrics",{method:"POST",headers:{"Content-Type":"application/json"},signal:g.signal,body:f}),a){let{answer:e}=await b.json(),t=[...p.messages,{role:"assistant",content:e}];p={...p,messages:t},L({field:"selectedConversation",value:u.X1}),(0,u.m7)(p);let r=N.map(e=>e.id===l.id?p:e);0===r.length&&r.push(p),L({field:"conversations",value:r}),(0,u.fB)(r),L({field:"loading",value:!1}),L({field:"messageIsStreaming",value:!1})}else{if(1===p.messages.length){let{content:t}=e,r=t.length>30?t.substring(0,30)+"...":t;p={...p,name:r}}L({field:"loading",value:!1});let r=y.getReader(),a=new TextDecoder,n=!1,s=!0,o="";for(;!n;){if(!0===t.current){g.abort(),n=!0;break}let{value:e,done:l}=await r.read();n=l;let i=a.decode(e);if(o+=i,s){s=!1;let e=[...p.messages,{role:"assistant",content:i}];p={...p,messages:e},L({field:"selectedConversation",value:p})}else{let e=p.messages.map((e,t)=>t===p.messages.length-1?{...e,content:o}:e);p={...p,messages:e},L({field:"selectedConversation",value:p})}}(0,u.m7)(p);let i=N.map(e=>e.id===l.id?p:e);0===i.length&&i.push(p),L({field:"conversations",value:i}),(0,u.fB)(i),L({field:"messageIsStreaming",value:!1})}}},[S,N,I,l,t]);(0,o.useCallback)(()=>{if(z){var e,t;null===(e=J.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=F.current)||void 0===t||t.focus()}},[z]);let V=()=>{if($.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=$.current;e+r<t-30?(G(!1),U(!0)):(G(!0),U(!1))}},q=()=>{var e;null===(e=$.current)||void 0===e||e.scrollTo({top:$.current.scrollHeight,behavior:"smooth"})},X=()=>{R(!K)},Q=()=>{confirm(r("Are you sure you want to clear all messages?"))&&l&&T(l,{key:"messages",value:[]})},ee=()=>{if(z){var e;null===(e=J.current)||void 0===e||e.scrollIntoView(!0)}},et=(0,m.P)(ee,250);return(0,o.useEffect)(()=>{et(),l&&A(l.messages[l.messages.length-2])},[l,et]),(0,o.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(G(t.isIntersecting),t.isIntersecting){var r;null===(r=F.current)||void 0===r||r.focus()}},{root:null,threshold:.5}),t=J.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[J]),(0,a.jsx)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541]",children:S||E?P?(0,a.jsx)(v.Y,{error:P}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:$,onScroll:V,children:(null==l?void 0:l.messages.length)===0?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"mx-auto flex flex-col space-y-5 md:space-y-10 px-3 pt-5 md:pt-12 sm:px-10",children:[0===C.length?(0,a.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:(0,a.jsx)("div",{children:(0,a.jsx)(p.Z,{size:"16px",className:"mx-auto"})})}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:"OOCL Chatbot Web App"}),(0,a.jsx)("div",{className:"flex h-full flex-col space-y-4 p-4",children:(0,a.jsxs)("ul",{children:[(0,a.jsx)("div",{className:"text-xl font-semibold text-black/50 dark:text-white/50",children:"About this web application"}),(0,a.jsxs)("div",{className:"text-[12px] text-black/50 dark:text-white/50 text-sm",children:[(0,a.jsx)("li",{children:"This web application utilizes Microsoft Azure OpenAI Service under OOCL's company account."}),(0,a.jsx)("li",{children:"Due to high demand, we will start logging the user ID and token count used. Data transmitted through the UI is not logged or stored. Your conversation history and data are only saved in your local browser cache. To retain this data, export it regularly."}),(0,a.jsx)("li",{children:"Its primary purpose is for DSCoE team internal evaluation and is not intended for development or production use. The application may be altered or terminated without any notice."}),(0,a.jsxs)("li",{children:["You are welcome to join this ",(0,a.jsx)("a",{href:"https://hkggitlab.oocl.com/ds/ds_chatgpt",target:"_blank",children:"GIT REPO"})," for discussions or contributions."]}),(0,a.jsxs)("li",{children:["The cost of the API service is managed by the DSCoE team. If you have heavy usage (over 1K prompts per day or any needs/use cases require to use GPT4-32k), please ",(0,a.jsx)("a",{href:"mailto:dscoesp@oocl.com",children:"contact us"})," to discuss."]})]})]})})]}),C.length>0&&(0,a.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,a.jsx)(g.q,{}),(0,a.jsx)(b.r,{conversation:l,prompts:O,onChangePrompt:e=>T(l,{key:"prompt",value:e})}),(0,a.jsx)(y.$,{label:r("Temperature"),onChangeTemperature:e=>T(l,{key:"temperature",value:e})})]})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[r("Model"),": ",null==l?void 0:l.model.name," | ",r("Temp"),": ",null==l?void 0:l.temperature," |",(0,a.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:X,children:(0,a.jsx)(n.Z,{size:18})}),(0,a.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:Q,children:(0,a.jsx)(s.Z,{size:18})})]}),K&&(0,a.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,a.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,a.jsx)(g.q,{})})}),null==l?void 0:l.messages.map((e,t)=>(0,a.jsx)(j.m,{message:e,messageIndex:t,onEdit:e=>{A(e),W(e,(null==l?void 0:l.messages.length)-t)}},t)),_&&(0,a.jsx)(h.G,{}),(0,a.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:J})]})}),(0,a.jsx)(f.x,{stopConversationRef:t,textareaRef:F,onSend:(e,t)=>{A(e),W(e,0,t)},onScrollDownClick:q,onRegenerate:()=>{D&&W(D,2,null)},showScrollDownButton:M})]}):(0,a.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,a.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to Chatbot UI"}),(0,a.jsxs)("div",{className:"text-center text-lg text-black dark:text-white",children:[(0,a.jsx)("div",{className:"mb-8",children:"Chatbot UI is an open source clone of OpenAI's ChatGPT UI."}),(0,a.jsx)("div",{className:"mb-2 font-bold",children:"Important: Chatbot UI is 100% unaffiliated with OpenAI."})]}),(0,a.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("div",{className:"mb-2",children:"Chatbot UI allows you to plug in your API key to use this UI with their API."}),(0,a.jsxs)("div",{className:"mb-2",children:["It is ",(0,a.jsx)("span",{className:"italic",children:"only"})," used to communicate with their API."]}),(0,a.jsx)("div",{className:"mb-2",children:r("Please set your OpenAI API key in the bottom left of the sidebar.")}),(0,a.jsxs)("div",{children:[r("If you don't have an OpenAI API key, you can get one here: "),(0,a.jsx)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:underline",children:"openai.com"})]})]})]})})});C.displayName="Chat",l()}catch(e){l(e)}})},39817:function(e,t,r){"use strict";r.a(e,async function(e,l){try{r.d(t,{x:function(){return v}});var a=r(85893),n=r(94568),s=r(21223),o=r(23461),i=r(63072),d=r(67294),c=r(61162),u=r(88990),m=r(84362),x=r(68452),p=r(9707),f=r(97939),h=e([m]);m=(h.then?(await h)():h)[0];let v=e=>{var t;let{onSend:r,onRegenerate:l,onScrollDownClick:h,stopConversationRef:v,textareaRef:g,showScrollDownButton:b}=e,{t:y}=(0,c.$G)("chat"),{state:{selectedConversation:j,messageIsStreaming:w,prompts:k},dispatch:N}=(0,d.useContext)(u.Z),[C,S]=(0,d.useState)(),[I,E]=(0,d.useState)(!1),[Z,P]=(0,d.useState)(!1),[_,O]=(0,d.useState)(0),[T,L]=(0,d.useState)(""),[D,A]=(0,d.useState)([]),[z,G]=(0,d.useState)(!1),[K,R]=(0,d.useState)(!1),[M,U]=(0,d.useState)(null),J=(0,d.useRef)(null),$=k.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())),F=e=>{let t=e.target.value,r=null==j?void 0:j.model.maxLength;if(r&&t.length>r){alert(y("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}S(t),X(t)},H=()=>{if(!w){if(!C){alert(y("Please enter a message"));return}r({role:"user",content:C},M),S(""),U(null),window.innerWidth<640&&g&&g.current&&g.current.blur()}},B=()=>{v.current=!0,setTimeout(()=>{v.current=!1},1e3)},Y=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},W=()=>{let e=$[_];e&&(S(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),Q(e)),P(!1)},V=e=>{Z?"ArrowDown"===e.key?(e.preventDefault(),O(e=>e<k.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),O(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),O(e=>e<k.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),W()):"Escape"===e.key?(e.preventDefault(),P(!1)):O(0):"Enter"!==e.key||I||Y()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),R(!K)):(e.preventDefault(),H())},q=e=>{let t;let r=/{{(.*?)}}/g,l=[];for(;null!==(t=r.exec(e));)l.push(t[1]);return l},X=(0,d.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(P(!0),L(t[0].slice(1))):(P(!1),L(""))},[]),Q=e=>{let t=q(e.content);A(t),t.length>0?G(!0):(S(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),X(e.content))},ee=e=>{let t=null==C?void 0:C.replace(/{{(.*?)}}/g,(t,r)=>{let l=D.indexOf(r);return e[l]});S(t),g&&g.current&&g.current.focus()};return(0,d.useEffect)(()=>{J.current&&(J.current.scrollTop=30*_)},[_]),(0,d.useEffect)(()=>{if(g&&g.current){var e,t;g.current.style.height="inherit",g.current.style.height="".concat(null===(e=g.current)||void 0===e?void 0:e.scrollHeight,"px"),g.current.style.overflow="".concat((null==g?void 0:null===(t=g.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[C]),(0,d.useEffect)(()=>{let e=e=>{J.current&&!J.current.contains(e.target)&&P(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:[(0,a.jsxs)("div",{className:"stretch mx-2 mt-4 flex flex-row gap-3 last:mb-2 md:mx-4 md:mt-[52px] md:last:mb-6 lg:mx-auto lg:max-w-3xl",children:[w&&(0,a.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:B,children:[(0,a.jsx)(n.Z,{size:16})," ",y("Stop Generating")]}),!w&&j&&j.messages.length>0&&(0,a.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:l,children:[(0,a.jsx)(s.Z,{size:16})," ",y("Regenerate response")]}),(0,a.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[K&&(0,a.jsx)("div",{className:"absolute left-0 bottom-14 rounded bg-white dark:bg-[#343541]",children:(0,a.jsx)(x.V,{plugin:M,onKeyDown:e=>{if("Escape"===e.key){var t;e.preventDefault(),R(!1),null===(t=g.current)||void 0===t||t.focus()}},onPluginChange:e=>{U(e),R(!1),g&&g.current&&g.current.focus()}})}),(0,a.jsx)("div",{className:"absolute bottom-full md:mb-4 mb-12 mx-auto flex w-full justify-center md:justify-end pointer-events-none",children:(0,a.jsx)(m.s,{content:C})}),(0,a.jsx)("textarea",{ref:g,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==g?void 0:null===(t=g.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",overflow:"".concat(g.current&&g.current.scrollHeight>400?"auto":"hidden")},placeholder:y('Type a message or type "/" to select a prompt...')||"",value:C,rows:1,onCompositionStart:()=>E(!0),onCompositionEnd:()=>E(!1),onChange:F,onKeyDown:V}),(0,a.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:H,children:w?(0,a.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,a.jsx)(o.Z,{size:18})}),b&&(0,a.jsx)("div",{className:"absolute bottom-12 right-0 lg:bottom-0 lg:-right-10",children:(0,a.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:h,children:(0,a.jsx)(i.Z,{size:18})})}),Z&&$.length>0&&(0,a.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,a.jsx)(p.t,{activePromptIndex:_,prompts:$,onSelect:W,onMouseOver:O,promptListRef:J})}),z&&(0,a.jsx)(f.g,{prompt:$[_],variables:D,onSubmit:ee,onClose:()=>G(!1)})]})]}),(0,a.jsxs)("div",{className:"px-3 pt-2 pb-3 text-center text-[13px] text-black/50 dark:text-white/50 md:px-4 md:pt-3 md:pb-6",children:[y("For issues and suggestions, feel free to contact us at: "),(0,a.jsx)("a",{href:"mailto:dscoesp@oocl.com",children:"dscoesp@oocl.com"})]})]})};l()}catch(e){l(e)}})},84362:function(e,t,r){"use strict";r.a(e,async function(e,l){try{r.d(t,{s:function(){return x}});var a=r(85893),n=r(67294),s=r(67421),o=r(88990),i=r(41910),d=r(60296),c=r(86574),u=r(70794),m=e([c]);c=(m.then?(await m)():m)[0];let p={"gpt-4":(0,u.Z)("0.03").div(1e3),"gpt-4-32k":(0,u.Z)("0.06").div(1e3),"gpt-3.5":(0,u.Z)("0.002").div(1e3)};function x(e){var t,r,l;let{t:u}=(0,s.$G)("chat"),{state:{selectedConversation:m}}=(0,n.useContext)(o.Z),[x,f]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=new c.OU(d.Q1,{...d.YL,"<|im_start|>":100264,"<|im_end|>":100265,"<|im_sep|>":100266},d.er);return f(e),()=>null==e?void 0:e.free()},[]);let h=[{role:"system",content:null!==(t=null==m?void 0:m.prompt)&&void 0!==t?t:""},...null!==(r=null==m?void 0:m.messages)&&void 0!==r?r:[],{role:"user",content:null!==(l=e.content)&&void 0!==l?l:""}],v=null==m?void 0:m.model.name.toLowerCase().startsWith("gpt-3.5"),g=v?"\n":"",b=v?"\n":"<|im_sep|>",y=[h.map(e=>{let{role:t,content:r}=e;return"<|im_start|>".concat(t).concat(b).concat(r,"<|im_end|>")}).join(g),"<|im_start|>assistant".concat(b)].join(g),j=null==x?void 0:x.encode(y,"all").length,w=p[(null==m?void 0:m.model.name.toLowerCase())||"gpt-3.5"],k=i.MU[null==m?void 0:m.model.id.replace("-deploy","")].tokenLimit;return null==w||null==j?null:(0,a.jsx)("div",{className:"bg-opacity-10 bg-neutral-300 rounded-full py-1 px-2.5 text-neutral-400 pointer-events-auto",children:u("{{count}} / {{context_size}} tokens",{count:j,context_size:k})})}l()}catch(e){l(e)}})},79420:function(e,t,r){"use strict";r.d(t,{G:function(){return n}});var l=r(85893),a=r(90553);let n=()=>(0,l.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,l.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,l.jsx)("div",{className:"min-w-[40px] items-end",children:(0,l.jsx)(a.Z,{size:30})}),(0,l.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"})]})})},84378:function(e,t,r){"use strict";r.d(t,{Y:function(){return n}});var l=r(85893),a=r(58403);let n=e=>{let{error:t}=e;return(0,l.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,l.jsx)("div",{className:"mb-5",children:(0,l.jsx)(a.Z,{size:36})}),(0,l.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,l.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,l.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,l.jsxs)("i",{children:["Code: ",t.code]}):""})]})}},11085:function(e,t,r){"use strict";r.d(t,{m:function(){return I}});var l=r(67294),a=r(85893),n=r(90553),s=r(8861),o=r(21942),i=r(74075),d=r(88198),c=r(93625),u=r(61162),m=r(62716),x=r(88990),p=r(67828),f=r(80335),h=r(93179),v=r(84283);let g={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="ABCDEFGHJKLMNPQRSTUVWXY3456789",l="";for(let t=0;t<e;t++)l+=r.charAt(Math.floor(Math.random()*r.length));return t?l.toLowerCase():l},y=(0,l.memo)(e=>{let{language:t,value:r}=e,{t:n}=(0,u.$G)("markdown"),[s,o]=(0,l.useState)(!1),i=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(r).then(()=>{o(!0),setTimeout(()=>{o(!1)},2e3)})},c=()=>{let e=g[t]||".file",l="file-".concat(b(3,!0)).concat(e),a=window.prompt(n("Enter file name")||"",l);if(!a)return;let s=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(s),i=document.createElement("a");i.download=a,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,a.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,a.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:i,children:[s?(0,a.jsx)(d.Z,{size:18}):(0,a.jsx)(p.Z,{size:18}),s?n("Copied!"):n("Copy code")]}),(0,a.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:c,children:(0,a.jsx)(f.Z,{size:18})})]})]}),(0,a.jsx)(h.Z,{language:t,style:v.vk,customStyle:{margin:0},wrapLongLines:!0,children:r})]})});y.displayName="CodeBlock";var j=r(16202);let w=(0,l.memo)(j.D,(e,t)=>e.children===t.children);var k=r(45884),N=r(29758),C=r(30399);let S=(0,l.memo)(e=>{var t;let{message:r,messageIndex:p,onEdit:f}=e,{t:h}=(0,u.$G)("chat"),{state:{selectedConversation:v,conversations:g,currentMessage:b,messageIsStreaming:j},dispatch:S}=(0,l.useContext)(x.Z),[I,E]=(0,l.useState)(!1),[Z,P]=(0,l.useState)(!1),[_,O]=(0,l.useState)(r.content),[T,L]=(0,l.useState)(!1),D=(0,l.useRef)(null),A=()=>{E(!I)},z=e=>{O(e.target.value),D.current&&(D.current.style.height="inherit",D.current.style.height="".concat(D.current.scrollHeight,"px"))},G=()=>{r.content!=_&&v&&f&&f({...r,content:_}),E(!1)},K=()=>{if(!v)return;let{messages:e}=v,t=e.findIndex(e=>e===r);if(t<0)return;t<e.length-1&&"assistant"===e[t+1].role?e.splice(t,2):e.splice(t,1);let l={...v,messages:e},{single:a,all:n}=(0,m.X1)(l,g);S({field:"selectedConversation",value:a}),S({field:"conversations",value:n})},R=e=>{"Enter"!==e.key||Z||e.shiftKey||(e.preventDefault(),G())},M=()=>{navigator.clipboard&&navigator.clipboard.writeText(r.content).then(()=>{L(!0),setTimeout(()=>{L(!1)},2e3)})};return(0,l.useEffect)(()=>{O(r.content)},[r.content]),(0,l.useEffect)(()=>{D.current&&(D.current.style.height="inherit",D.current.style.height="".concat(D.current.scrollHeight,"px"))},[I]),(0,a.jsx)("div",{className:"group md:px-4 ".concat("assistant"===r.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,a.jsxs)("div",{className:"relative m-auto flex py-4 text-base md:gap-6 md:py-6",children:[(0,a.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===r.role?(0,a.jsx)(n.Z,{size:30}):(0,a.jsx)(s.Z,{size:30})}),(0,a.jsx)("div",{className:"prose max-w-none w-full dark:prose-invert pr-2 md:pr-8",children:"user"===r.role?(0,a.jsxs)("div",{className:"flex w-full",children:[I?(0,a.jsxs)("div",{className:"flex w-full flex-col",children:[(0,a.jsx)("textarea",{ref:D,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:_,onChange:z,onKeyDown:R,onCompositionStart:()=>P(!0),onCompositionEnd:()=>P(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,a.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,a.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:G,disabled:_.trim().length<=0,children:h("Save & Submit")}),(0,a.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{O(r.content),E(!1)},children:h("Cancel")})]})]}):(0,a.jsx)("div",{className:"prose max-w-none whitespace-pre-wrap dark:prose-invert flex-1",children:r.content}),!I&&(0,a.jsxs)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:[(0,a.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:A,children:(0,a.jsx)(o.Z,{size:20})}),(0,a.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:K,children:(0,a.jsx)(i.Z,{size:20})})]})]}):(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(w,{className:"prose max-w-none dark:prose-invert flex-1",remarkPlugins:[N.Z,C.Z],rehypePlugins:[k.Z],components:{code(e){let{node:t,inline:r,className:l,children:n,...s}=e;if(n.length){if("▍"==n[0])return(0,a.jsx)("span",{className:"animate-pulse cursor-default mt-1",children:"▍"});n[0]=n[0].replace("`▍`","▍")}let o=/language-(\w+)/.exec(l||"");return r?(0,a.jsx)("code",{className:l,...s,children:n}):(0,a.jsx)(y,{language:o&&o[1]||"",value:String(n).replace(/\n$/,""),...s},Math.random())},table(e){let{children:t}=e;return(0,a.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,a.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,a.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:"".concat(r.content).concat(j&&p==(null!==(t=null==v?void 0:v.messages.length)&&void 0!==t?t:0)-1?"`▍`":"")}),(0,a.jsx)("div",{className:"md:-mr-8 ml-1 md:ml-0 flex flex-col md:flex-row gap-4 md:gap-1 items-center md:items-start justify-end md:justify-start",children:T?(0,a.jsx)(d.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,a.jsx)("button",{className:"invisible group-hover:visible focus:visible text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",onClick:M,children:(0,a.jsx)(c.Z,{size:20})})})]})})]})})});S.displayName="ChatMessage";let I=(0,l.memo)(S,(e,t)=>e.message.content===t.message.content)},11046:function(e,t,r){"use strict";r.d(t,{q:function(){return o}});var l=r(85893),a=r(67294),n=r(61162),s=r(88990);let o=()=>{var e;let{t}=(0,n.$G)("chat"),{state:{selectedConversation:r,models:o,defaultModelId:i},handleUpdateConversation:d,dispatch:c}=(0,a.useContext)(s.Z),u=e=>{r&&d(r,{key:"model",value:o.find(t=>t.id===e.target.value)})};return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Model")}),(0,l.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,l.jsx)("select",{className:"w-full bg-transparent p-2",placeholder:t("Select a model")||"",value:(null==r?void 0:null===(e=r.model)||void 0===e?void 0:e.id)||i,onChange:u,children:o.map(e=>(0,l.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.id===i?"Default (".concat(e.name,")"):e.name},e.id))})})]})}},68452:function(e,t,r){"use strict";r.d(t,{V:function(){return o}});var l=r(85893),a=r(67294),n=r(61162),s=r(2403);let o=e=>{let{plugin:t,onPluginChange:r,onKeyDown:o}=e,{t:i}=(0,n.$G)("chat"),d=(0,a.useRef)(null),c=e=>{let t=d.current,l=(null==t?void 0:t.options.length)||0;"/"===e.key&&e.metaKey?(e.preventDefault(),t&&(t.selectedIndex=(t.selectedIndex+1)%l,t.dispatchEvent(new Event("change")))):"/"===e.key&&e.shiftKey&&e.metaKey?(e.preventDefault(),t&&(t.selectedIndex=(t.selectedIndex-1+l)%l,t.dispatchEvent(new Event("change")))):"Enter"===e.key?(e.preventDefault(),t&&t.dispatchEvent(new Event("change")),r(s.xN.find(e=>e.name===(null==t?void 0:t.selectedOptions[0].innerText)))):o(e)};return(0,a.useEffect)(()=>{d.current&&d.current.focus()},[]),(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("div",{className:"mb-1 w-full rounded border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,l.jsxs)("select",{ref:d,className:"w-full cursor-pointer bg-transparent p-2",placeholder:i("Select a plugin")||"",value:(null==t?void 0:t.id)||"",onChange:e=>{r(s.xN.find(t=>t.id===e.target.value))},onKeyDown:e=>{c(e)},children:[(0,l.jsx)("option",{value:"chatgpt",className:"dark:bg-[#343541] dark:text-white",children:"ChatGPT"},"chatgpt"),s.xN.map(e=>(0,l.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.name},e.id))]})})})}},9707:function(e,t,r){"use strict";r.d(t,{t:function(){return a}});var l=r(85893);let a=e=>{let{prompts:t,activePromptIndex:r,onSelect:a,onMouseOver:n,promptListRef:s}=e;return(0,l.jsx)("ul",{ref:s,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,l.jsx)("li",{className:"".concat(t===r?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),a()},onMouseEnter:()=>n(t),children:e.name},e.id))})}},41347:function(e,t,r){"use strict";r.d(t,{r:function(){return d}});var l=r(85893),a=r(67294),n=r(61162),s=r(64689),o=r(9707),i=r(97939);let d=e=>{var t;let{conversation:r,prompts:d,onChangePrompt:c}=e,{t:u}=(0,n.$G)("chat"),[m,x]=(0,a.useState)(""),[p,f]=(0,a.useState)(0),[h,v]=(0,a.useState)(!1),[g,b]=(0,a.useState)(""),[y,j]=(0,a.useState)([]),[w,k]=(0,a.useState)(!1),N=(0,a.useRef)(null),C=(0,a.useRef)(null),S=d.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())),I=e=>{let t=e.target.value,l=r.model.maxLength;if(t.length>l){alert(u("Prompt limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:l,valueLength:t.length}));return}x(t),P(t),t.length>0&&c(t)},E=()=>{let e=S[p];x(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),_(e),v(!1)},Z=e=>{let t;let r=/{{(.*?)}}/g,l=[];for(;null!==(t=r.exec(e));)l.push(t[1]);return l},P=(0,a.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(v(!0),b(t[0].slice(1))):(v(!1),b(""))},[]),_=e=>{let t=Z(e.content);if(j(t),t.length>0)k(!0);else{let t=null==m?void 0:m.replace(/\/\w*$/,e.content);x(t),c(t),P(e.content)}},O=e=>{let t=null==m?void 0:m.replace(/{{(.*?)}}/g,(t,r)=>{let l=y.indexOf(r);return e[l]});x(t),c(t),N&&N.current&&N.current.focus()},T=e=>{h&&("ArrowDown"===e.key?(e.preventDefault(),f(e=>e<d.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),f(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),f(e=>e<d.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),E()):"Escape"===e.key?(e.preventDefault(),v(!1)):f(0))};return(0,a.useEffect)(()=>{if(N&&N.current){var e;N.current.style.height="inherit",N.current.style.height="".concat(null===(e=N.current)||void 0===e?void 0:e.scrollHeight,"px")}},[m]),(0,a.useEffect)(()=>{r.prompt?x(r.prompt):x(s.cl)},[r]),(0,a.useEffect)(()=>{let e=e=>{C.current&&!C.current.contains(e.target)&&v(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:u("System Prompt")}),(0,l.jsx)("textarea",{ref:N,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{resize:"none",bottom:"".concat(null==N?void 0:null===(t=N.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(N.current&&N.current.scrollHeight>400?"auto":"hidden")},placeholder:u('Enter a prompt or type "/" to select a prompt...')||"",value:u(m)||"",rows:1,onChange:I,onKeyDown:T}),h&&S.length>0&&(0,l.jsx)("div",{children:(0,l.jsx)(o.t,{activePromptIndex:p,prompts:S,onSelect:E,onMouseOver:f,promptListRef:C})}),w&&(0,l.jsx)(i.g,{prompt:d[p],variables:y,onSubmit:O,onClose:()=>k(!1)})]})}},10094:function(e,t,r){"use strict";r.d(t,{$:function(){return i}});var l=r(85893),a=r(67294),n=r(61162),s=r(64689),o=r(88990);let i=e=>{var t;let{label:r,onChangeTemperature:i}=e,{state:{conversations:d}}=(0,a.useContext)(o.Z),c=d[d.length-1],[u,m]=(0,a.useState)(null!==(t=null==c?void 0:c.temperature)&&void 0!==t?t:s.Ar),{t:x}=(0,n.$G)("chat"),p=e=>{let t=parseFloat(e.target.value);m(t),i(t)};return(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:r}),(0,l.jsx)("span",{className:"text-[12px] text-black/50 dark:text-white/50 text-sm",children:x("Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.")}),(0,l.jsx)("span",{className:"mt-2 mb-1 text-center text-neutral-900 dark:text-neutral-100",children:u.toFixed(1)}),(0,l.jsx)("input",{className:"cursor-pointer",type:"range",min:0,max:1,step:.1,value:u,onChange:p}),(0,l.jsxs)("ul",{className:"w mt-2 pb-8 flex justify-between px-[24px] text-neutral-900 dark:text-neutral-100",children:[(0,l.jsx)("li",{className:"flex justify-center",children:(0,l.jsx)("span",{className:"absolute",children:x("Precise")})}),(0,l.jsx)("li",{className:"flex justify-center",children:(0,l.jsx)("span",{className:"absolute",children:x("Neutral")})}),(0,l.jsx)("li",{className:"flex justify-center",children:(0,l.jsx)("span",{className:"absolute",children:x("Creative")})})]})]})}},97939:function(e,t,r){"use strict";r.d(t,{g:function(){return n}});var l=r(85893),a=r(67294);let n=e=>{let{prompt:t,variables:r,onSubmit:n,onClose:s}=e,[o,i]=(0,a.useState)(r.map(e=>({key:e,value:""})).filter((e,t,r)=>r.findIndex(t=>t.key===e.key)===t)),d=(0,a.useRef)(null),c=(0,a.useRef)(null),u=(e,t)=>{i(r=>{let l=[...r];return l[e].value=t,l})},m=()=>{if(o.some(e=>""===e.value)){alert("Please fill out all variables");return}n(o.map(e=>e.value)),s()},x=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&s():(e.preventDefault(),m())};return(0,a.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&s()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[s]),(0,a.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:x,children:(0,l.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,l.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,l.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),o.map((e,t)=>(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,l.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,l.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:m,children:"Submit"})]})})}},71054:function(e,t,r){"use strict";r.d(t,{W:function(){return z}});var l=r(85893),a=r(67294),n=r(61162),s=r(81058),o=r(64689),i=r(62716),d=r(76921),c=r(79913);let u=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),r=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),r&&(r=JSON.parse(r));let l={version:4,history:e||[],folders:t||[],prompts:r||[]},a=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),s=document.createElement("a");s.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,r=e.getDate();return"".concat(t,"-").concat(r)}(),".json"),s.href=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)},m=e=>{let{history:t,folders:r,prompts:l}=function(e){if(Array.isArray(e))return{version:4,history:(0,c.m)(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:(0,c.m)(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),a=localStorage.getItem("conversationHistory"),n=a?JSON.parse(a):[],s=[...n,...t].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));localStorage.setItem("conversationHistory",JSON.stringify(s)),s.length>0?localStorage.setItem("selectedConversation",JSON.stringify(s[s.length-1])):localStorage.removeItem("selectedConversation");let o=localStorage.getItem("folders"),i=o?JSON.parse(o):[],d=[...i,...r].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));localStorage.setItem("folders",JSON.stringify(d));let u=localStorage.getItem("prompts"),m=u?JSON.parse(u):[],x=[...m,...l].filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id));return localStorage.setItem("prompts",JSON.stringify(x)),{version:4,history:s,folders:d,prompts:x}};var x=r(41910),p=r(88990),f=r(35887),h=r(47447),v=r(88198),g=r(97283),b=r(30471),y=r(74075),j=r(87766);let w=(0,a.createContext)(void 0),k=e=>{let{conversation:t}=e,{state:{selectedConversation:r,messageIsStreaming:n},handleSelectConversation:s,handleUpdateConversation:o}=(0,a.useContext)(p.Z),{handleDeleteConversation:i}=(0,a.useContext)(w),[d,c]=(0,a.useState)(!1),[u,m]=(0,a.useState)(!1),[x,f]=(0,a.useState)(""),k=e=>{"Enter"===e.key&&(e.preventDefault(),r&&C(r))},N=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},C=e=>{x.trim().length>0&&(o(e,{key:"name",value:x}),f(""),m(!1))},S=e=>{e.stopPropagation(),d?i(t):u&&C(t),c(!1),m(!1)},I=e=>{e.stopPropagation(),c(!1),m(!1)},E=e=>{e.stopPropagation(),m(!0),r&&f(r.name)},Z=e=>{e.stopPropagation(),c(!0)};return(0,a.useEffect)(()=>{u?c(!1):d&&m(!1)},[u,d]),(0,l.jsxs)("div",{className:"relative flex items-center",children:[u&&(null==r?void 0:r.id)===t.id?(0,l.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,l.jsx)(h.Z,{size:18}),(0,l.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:x,onChange:e=>f(e.target.value),onKeyDown:k,autoFocus:!0})]}):(0,l.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(n?"disabled:cursor-not-allowed":""," ").concat((null==r?void 0:r.id)===t.id?"bg-[#343541]/90":""),onClick:()=>s(t),disabled:n,draggable:"true",onDragStart:e=>N(e,t),children:[(0,l.jsx)(h.Z,{size:18}),(0,l.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==r?void 0:r.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(d||u)&&(null==r?void 0:r.id)===t.id&&(0,l.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,l.jsx)(j.Z,{handleClick:S,children:(0,l.jsx)(v.Z,{size:18})}),(0,l.jsx)(j.Z,{handleClick:I,children:(0,l.jsx)(g.Z,{size:18})})]}),(null==r?void 0:r.id)===t.id&&!d&&!u&&(0,l.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,l.jsx)(j.Z,{handleClick:E,children:(0,l.jsx)(b.Z,{size:18})}),(0,l.jsx)(j.Z,{handleClick:Z,children:(0,l.jsx)(y.Z,{size:18})})]})]})},N=e=>{let{searchTerm:t}=e,{state:{folders:r,conversations:n},handleUpdateConversation:s}=(0,a.useContext)(p.Z),o=(e,t)=>{if(e.dataTransfer){let r=JSON.parse(e.dataTransfer.getData("conversation"));s(r,{key:"folderId",value:t.id})}},i=e=>n&&n.filter(e=>e.folderId).map((t,r)=>{if(t.folderId===e.id)return(0,l.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,l.jsx)(k,{conversation:t})},r)});return(0,l.jsx)("div",{className:"flex w-full flex-col pt-2",children:r.filter(e=>"chat"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,r)=>(0,l.jsx)(f.Z,{searchTerm:t,currentFolder:e,handleDrop:o,folderComponent:i(e)},r))})};var C=r(75846),S=r(52216);let I=e=>{let{text:t,icon:r,onClick:a}=e;return(0,l.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:a,children:[(0,l.jsx)("div",{children:r}),(0,l.jsx)("span",{children:t})]})},E=e=>{let{onImport:t}=e,{t:r}=(0,n.$G)("sidebar");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("input",{id:"import-file",className:"sr-only",tabIndex:-1,type:"file",accept:".json",onChange:e=>{var r;if(!(null===(r=e.target.files)||void 0===r?void 0:r.length))return;let l=e.target.files[0],a=new FileReader;a.onload=e=>{var r;t(JSON.parse(null===(r=e.target)||void 0===r?void 0:r.result))},a.readAsText(l)}}),(0,l.jsx)(I,{text:r("Import chat history"),icon:(0,l.jsx)(S.Z,{size:18}),onClick:()=>{let e=document.querySelector("#import-file");e&&e.click()}})]})};var Z=r(35336);let P=e=>{let{apiKey:t,onApiKeyChange:r}=e,{t:s}=(0,n.$G)("sidebar"),[o,i]=(0,a.useState)(!1),[d,c]=(0,a.useState)(t),u=(0,a.useRef)(null),m=e=>{"Enter"===e.key&&(e.preventDefault(),x(d))},x=e=>{r(e.trim()),i(!1)};return(0,a.useEffect)(()=>{if(o){var e;null===(e=u.current)||void 0===e||e.focus()}},[o]),o?(0,l.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,l.jsx)(Z.Z,{size:18}),(0,l.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",type:"password",value:d,onChange:e=>c(e.target.value),onKeyDown:m,placeholder:s("API Key")||"API Key"}),(0,l.jsxs)("div",{className:"flex w-[40px]",children:[(0,l.jsx)(v.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),x(d)}}),(0,l.jsx)(g.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i(!1),c(t)}})]})]}):(0,l.jsx)(I,{text:s("OpenAI API Key"),icon:(0,l.jsx)(Z.Z,{size:18}),onClick:()=>i(!0)})},_=e=>{let{onClearConversations:t}=e,[r,s]=(0,a.useState)(!1),{t:o}=(0,n.$G)("sidebar"),i=()=>{t(),s(!1)};return r?(0,l.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,l.jsx)(y.Z,{size:18}),(0,l.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:o("Are you sure?")}),(0,l.jsxs)("div",{className:"flex w-[40px]",children:[(0,l.jsx)(v.Z,{className:"ml-auto mr-1 min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),i()}}),(0,l.jsx)(g.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),s(!1)}})]})]}):(0,l.jsx)(I,{text:o("Clear conversations"),icon:(0,l.jsx)(y.Z,{size:18}),onClick:()=>s(!0)})},O=()=>{let{t:e}=(0,n.$G)("sidebar"),[t,r]=(0,a.useState)(!1),{state:{apiKey:s,lightMode:o,serverSideApiKeyIsSet:i,serverSidePluginKeysSet:d,conversations:c},dispatch:u}=(0,a.useContext)(p.Z),{handleClearConversations:m,handleImportConversations:x,handleExportData:f,handleApiKeyChange:h}=(0,a.useContext)(w);return(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[c.length>0?(0,l.jsx)(_,{onClearConversations:m}):null,(0,l.jsx)(E,{onImport:x}),(0,l.jsx)(I,{text:e("Export chat history"),icon:(0,l.jsx)(C.Z,{size:18}),onClick:()=>f()}),i?null:(0,l.jsx)(P,{apiKey:s,onApiKeyChange:h})]})},T=e=>{let{conversations:t}=e;return(0,l.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,l.jsx)(k,{conversation:e},t))})};var L=r(27301);let D={searchTerm:"",filteredConversations:[]};var A=r(57632);let z=()=>{let{t:e}=(0,n.$G)("sidebar"),t=(0,s.L)({initialState:D}),{state:{conversations:r,showChatbar:c,defaultModelId:f,folders:h,pluginKeys:v},dispatch:g,handleCreateFolder:b,handleNewConversation:y,handleUpdateConversation:j}=(0,a.useContext)(p.Z),{state:{searchTerm:k,filteredConversations:C},dispatch:S}=t,I=(0,a.useCallback)(e=>{g({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[g]),E=e=>{if(v.some(t=>t.pluginId===e.pluginId)){let t=v.map(t=>t.pluginId===e.pluginId?e:t);g({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else g({field:"pluginKeys",value:[...v,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...v,e]))},Z=e=>{let t=v.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){g({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}g({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},P=()=>{u()},_=e=>{let{history:t,folders:r,prompts:l}=m(e);g({field:"conversations",value:t}),g({field:"selectedConversation",value:t[t.length-1]}),g({field:"folders",value:r}),g({field:"prompts",value:l}),window.location.reload()},z=()=>{f&&g({field:"selectedConversation",value:{id:(0,A.Z)(),name:e("New Conversation"),messages:[],model:x.MU[f],prompt:o.cl,temperature:o.Ar,folderId:null}}),g({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let t=h.filter(e=>"chat"!==e.type);g({field:"folders",value:t}),(0,d._)(t)},G=t=>{let l=r.filter(e=>e.id!==t.id);g({field:"conversations",value:l}),S({field:"searchTerm",value:""}),(0,i.fB)(l),l.length>0?(g({field:"selectedConversation",value:l[l.length-1]}),(0,i.m7)(l[l.length-1])):(f&&g({field:"selectedConversation",value:{id:(0,A.Z)(),name:e("New Conversation"),messages:[],model:x.MU[f],prompt:o.cl,temperature:o.Ar,folderId:null}}),localStorage.removeItem("selectedConversation"))},K=()=>{g({field:"showChatbar",value:!c}),localStorage.setItem("showChatbar",JSON.stringify(!c))},R=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));j(t,{key:"folderId",value:0}),S({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,a.useEffect)(()=>{k?S({field:"filteredConversations",value:r.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(k.toLowerCase())})}):S({field:"filteredConversations",value:r})},[k,r]),(0,l.jsx)(w.Provider,{value:{...t,handleDeleteConversation:G,handleClearConversations:z,handleImportConversations:_,handleExportData:P,handlePluginKeyChange:E,handleClearPluginKey:Z,handleApiKeyChange:I},children:(0,l.jsx)(L.Z,{side:"left",isOpen:c,addItemButtonTitle:e("New chat"),itemComponent:(0,l.jsx)(T,{conversations:C}),folderComponent:(0,l.jsx)(N,{searchTerm:k}),items:C,searchTerm:k,handleSearchTerm:e=>S({field:"searchTerm",value:e}),toggleOpen:K,handleCreateItem:y,handleCreateFolder:()=>b(e("New folder"),"chat"),handleDrop:R,footerComponent:(0,l.jsx)(O,{})})})}},35887:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var l=r(85893),a=r(87664),n=r(62577),s=r(88198),o=r(97283),i=r(30471),d=r(74075),c=r(67294),u=r(88990),m=r(87766);let x=e=>{let{currentFolder:t,searchTerm:r,handleDrop:x,folderComponent:p}=e,{handleDeleteFolder:f,handleUpdateFolder:h}=(0,c.useContext)(u.Z),[v,g]=(0,c.useState)(!1),[b,y]=(0,c.useState)(!1),[j,w]=(0,c.useState)(""),[k,N]=(0,c.useState)(!1),C=e=>{"Enter"===e.key&&(e.preventDefault(),S())},S=()=>{h(t.id,j),w(""),y(!1)},I=e=>{e.dataTransfer&&(N(!0),x(e,t),e.target.style.background="none")},E=e=>{e.preventDefault()},Z=e=>{e.target.style.background="#343541"},P=e=>{e.target.style.background="none"};return(0,c.useEffect)(()=>{b?g(!1):v&&y(!1)},[b,v]),(0,c.useEffect)(()=>{r?N(!0):N(!1)},[r]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"relative flex items-center",children:[b?(0,l.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[k?(0,l.jsx)(a.Z,{size:18}):(0,l.jsx)(n.Z,{size:18}),(0,l.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:j,onChange:e=>w(e.target.value),onKeyDown:C,autoFocus:!0})]}):(0,l.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>N(!k),onDrop:e=>I(e),onDragOver:E,onDragEnter:Z,onDragLeave:P,children:[k?(0,l.jsx)(a.Z,{size:18}):(0,l.jsx)(n.Z,{size:18}),(0,l.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(v||b)&&(0,l.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,l.jsx)(m.Z,{handleClick:e=>{e.stopPropagation(),v?f(t.id):b&&S(),g(!1),y(!1)},children:(0,l.jsx)(s.Z,{size:18})}),(0,l.jsx)(m.Z,{handleClick:e=>{e.stopPropagation(),g(!1),y(!1)},children:(0,l.jsx)(o.Z,{size:18})})]}),!v&&!b&&(0,l.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,l.jsx)(m.Z,{handleClick:e=>{e.stopPropagation(),y(!0),w(t.name)},children:(0,l.jsx)(i.Z,{size:18})}),(0,l.jsx)(m.Z,{handleClick:e=>{e.stopPropagation(),g(!0)},children:(0,l.jsx)(d.Z,{size:18})})]})]}),k?p:null]})};var p=x},76262:function(e,t,r){"use strict";r.d(t,{w:function(){return n}});var l=r(85893),a=r(1177);let n=e=>{let{selectedConversation:t,onNewConversation:r}=e;return(0,l.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,l.jsx)("div",{className:"mr-4"}),(0,l.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,l.jsx)(a.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:r})]})}},70185:function(e,t,r){"use strict";r.d(t,{Z:function(){return S}});var l=r(85893),a=r(67294),n=r(67421),s=r(81058),o=r(36686),i=r(41910),d=r(88990),c=r(35887),u=r(12691),m=r(88198),x=r(97283),p=r(74075),f=r(87766);let h=(0,a.createContext)(void 0);var v=r(61162);let g=e=>{let{prompt:t,onClose:r,onUpdatePrompt:n}=e,{t:s}=(0,v.$G)("promptbar"),[o,i]=(0,a.useState)(t.name),[d,c]=(0,a.useState)(t.description),[u,m]=(0,a.useState)(t.content),x=(0,a.useRef)(null),p=(0,a.useRef)(null),f=e=>{"Enter"!==e.key||e.shiftKey||(n({...t,name:o,description:d,content:u.trim()}),r())};return(0,a.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),r()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[r]),(0,a.useEffect)(()=>{var e;null===(e=p.current)||void 0===e||e.focus()},[]),(0,l.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",onKeyDown:f,children:(0,l.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,l.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,l.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,l.jsxs)("div",{ref:x,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,l.jsx)("div",{className:"text-sm font-bold text-black dark:text-neutral-200",children:s("Name")}),(0,l.jsx)("input",{ref:p,className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",placeholder:s("A name for your prompt.")||"",value:o,onChange:e=>i(e.target.value)}),(0,l.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:s("Description")}),(0,l.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:s("A description for your prompt.")||"",value:d,onChange:e=>c(e.target.value),rows:3}),(0,l.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:s("Prompt")}),(0,l.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:s("Prompt content. Use {{}} to denote a variable. Ex: {{name}} is a {{adjective}} {{noun}}")||"",value:u,onChange:e=>m(e.target.value),rows:10}),(0,l.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{let e={...t,name:o,description:d,content:u.trim()};n(e),r()},children:s("Save")})]})]})})})},b=e=>{let{prompt:t}=e,{dispatch:r,handleUpdatePrompt:n,handleDeletePrompt:s}=(0,a.useContext)(h),[o,i]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),[y,j]=(0,a.useState)(""),w=e=>{n(e),r({field:"searchTerm",value:""})},k=e=>{e.stopPropagation(),d&&(s(t),r({field:"searchTerm",value:""})),c(!1)},N=e=>{e.stopPropagation(),c(!1)},C=e=>{e.stopPropagation(),c(!0)},S=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("prompt",JSON.stringify(t))};return(0,a.useEffect)(()=>{v?c(!1):d&&b(!1)},[v,d]),(0,l.jsxs)("div",{className:"relative flex items-center",children:[(0,l.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",draggable:"true",onClick:e=>{e.stopPropagation(),i(!0)},onDragStart:e=>S(e,t),onMouseLeave:()=>{c(!1),b(!1),j("")},children:[(0,l.jsx)(u.Z,{size:18}),(0,l.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all pr-4 text-left text-[12.5px] leading-3",children:t.name})]}),(d||v)&&(0,l.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,l.jsx)(f.Z,{handleClick:k,children:(0,l.jsx)(m.Z,{size:18})}),(0,l.jsx)(f.Z,{handleClick:N,children:(0,l.jsx)(x.Z,{size:18})})]}),!d&&!v&&(0,l.jsx)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:(0,l.jsx)(f.Z,{handleClick:C,children:(0,l.jsx)(p.Z,{size:18})})}),o&&(0,l.jsx)(g,{prompt:t,onClose:()=>i(!1),onUpdatePrompt:w})]})},y=()=>{let{state:{folders:e}}=(0,a.useContext)(d.Z),{state:{searchTerm:t,filteredPrompts:r},handleUpdatePrompt:n}=(0,a.useContext)(h),s=(e,t)=>{if(e.dataTransfer){let r=JSON.parse(e.dataTransfer.getData("prompt")),l={...r,folderId:t.id};n(l)}},o=e=>r.filter(e=>e.folderId).map((t,r)=>{if(t.folderId===e.id)return(0,l.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,l.jsx)(b,{prompt:t})},r)});return(0,l.jsx)("div",{className:"flex w-full flex-col pt-2",children:e.filter(e=>"prompt"===e.type).sort((e,t)=>e.name.localeCompare(t.name)).map((e,r)=>(0,l.jsx)(c.Z,{searchTerm:t,currentFolder:e,handleDrop:s,folderComponent:o(e)},r))})},j=e=>{let{prompts:t}=e;return(0,l.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.slice().reverse().map((e,t)=>(0,l.jsx)(b,{prompt:e},t))})};var w=r(27301);let k={searchTerm:"",filteredPrompts:[]};var N=r(57632);let C=()=>{let{t:e}=(0,n.$G)("promptbar"),t=(0,s.L)({initialState:k}),{state:{prompts:r,defaultModelId:c,showPromptbar:u},dispatch:m,handleCreateFolder:x}=(0,a.useContext)(d.Z),{state:{searchTerm:p,filteredPrompts:f},dispatch:v}=t,g=()=>{m({field:"showPromptbar",value:!u}),localStorage.setItem("showPromptbar",JSON.stringify(!u))},b=()=>{if(c){let e={id:(0,N.Z)(),name:"Prompt ".concat(r.length+1),description:"",content:"",model:i.MU[c],folderId:null},t=[...r,e];m({field:"prompts",value:t}),(0,o.V)(t)}},C=e=>{let t=r.filter(t=>t.id!==e.id);m({field:"prompts",value:t}),(0,o.V)(t)},S=e=>{let t=r.map(t=>t.id===e.id?e:t);m({field:"prompts",value:t}),(0,o.V)(t)},I=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("prompt")),r={...t,folderId:e.target.dataset.folderId};S(r),e.target.style.background="none"}};return(0,a.useEffect)(()=>{p?v({field:"filteredPrompts",value:r.filter(e=>{let t=e.name.toLowerCase()+" "+e.description.toLowerCase()+" "+e.content.toLowerCase();return t.includes(p.toLowerCase())})}):v({field:"filteredPrompts",value:r})},[p,r]),(0,l.jsx)(h.Provider,{value:{...t,handleCreatePrompt:b,handleDeletePrompt:C,handleUpdatePrompt:S},children:(0,l.jsx)(w.Z,{side:"right",isOpen:u,addItemButtonTitle:e("New prompt"),itemComponent:(0,l.jsx)(j,{prompts:f.filter(e=>!e.folderId)}),folderComponent:(0,l.jsx)(y,{}),items:f,searchTerm:p,handleSearchTerm:e=>v({field:"searchTerm",value:e}),toggleOpen:g,handleCreateItem:b,handleCreateFolder:()=>x(e("New folder"),"prompt"),handleDrop:I})})};var S=C},27301:function(e,t,r){"use strict";r.d(t,{Z:function(){return h}});var l=r(85893),a=r(1177),n=r(16745),s=r(92005),o=r(67421),i=r(98963),d=r(89014);let c=e=>{let{onClick:t,side:r}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"fixed top-5 ".concat("right"===r?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===r?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,l.jsx)(i.Z,{}):(0,l.jsx)(d.Z,{})}),(0,l.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},u=e=>{let{onClick:t,side:r}=e;return(0,l.jsx)("button",{className:"fixed top-2.5 ".concat("right"===r?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 sm:top-0.5 sm:").concat("right"===r?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,l.jsx)(d.Z,{}):(0,l.jsx)(i.Z,{})})};var m=r(97283),x=r(61162);let p=e=>{let{placeholder:t,searchTerm:r,onSearch:a}=e,{t:n}=(0,x.$G)("sidebar"),s=e=>{a(e.target.value)},o=()=>{a("")};return(0,l.jsxs)("div",{className:"relative flex items-center",children:[(0,l.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:n(t)||"",value:r,onChange:s}),r&&(0,l.jsx)(m.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:o})]})},f=e=>{let{isOpen:t,addItemButtonTitle:r,side:i,items:d,itemComponent:m,folderComponent:x,footerComponent:f,searchTerm:h,handleSearchTerm:v,toggleOpen:g,handleCreateItem:b,handleCreateFolder:y,handleDrop:j}=e,{t:w}=(0,o.$G)("promptbar"),k=e=>{e.preventDefault()},N=e=>{e.target.style.background="#343541"},C=e=>{e.target.style.background="none"};return t?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"fixed top-0 ".concat(i,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("button",{className:"text-sidebar flex w-[190px] flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{b(),v("")},children:[(0,l.jsx)(a.Z,{size:16}),r]}),(0,l.jsx)("button",{className:"ml-2 flex flex-shrink-0 cursor-pointer items-center gap-3 rounded-md border border-white/20 p-3 text-sm text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:y,children:(0,l.jsx)(n.Z,{size:16})})]}),(0,l.jsx)(p,{placeholder:w("Search...")||"",searchTerm:h,onSearch:v}),(0,l.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==d?void 0:d.length)>0&&(0,l.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:x}),(null==d?void 0:d.length)>0?(0,l.jsx)("div",{className:"pt-2",onDrop:j,onDragOver:k,onDragEnter:N,onDragLeave:C,children:m}):(0,l.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,l.jsx)(s.Z,{className:"mx-auto mb-3"}),(0,l.jsx)("span",{className:"text-[14px] leading-normal",children:w("No data.")})]})]}),f]}),(0,l.jsx)(c,{onClick:g,side:i})]}):(0,l.jsx)(u,{onClick:g,side:i})};var h=f},79408:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var l=r(85893);let a=e=>{let{size:t="1em",className:r=""}=e;return(0,l.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(r),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,l.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,l.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,l.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,l.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,l.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,l.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,l.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,l.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var n=a},59227:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var l=r(33299);function a(){var e;let{data:t}=(0,l.useSession)(),r=null==t?void 0:null===(e=t.tokens)||void 0===e?void 0:e.accessToken;return r}},81058:function(e,t,r){"use strict";r.d(t,{L:function(){return a}});var l=r(67294);let a=e=>{let{initialState:t}=e,r=(e,r)=>{if(!r.type)return{...e,[r.field]:r.value};if("reset"===r.type)return t;throw Error()},[a,n]=(0,l.useReducer)(r,t);return(0,l.useMemo)(()=>({state:a,dispatch:n}),[a,n])}},88990:function(e,t,r){"use strict";var l=r(67294);let a=(0,l.createContext)(void 0);t.Z=a},45928:function(e,t,r){"use strict";r.d(t,{E:function(){return l}});let l={apiKey:"",loading:!1,pluginKeys:[],lightMode:"dark",messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,currentMessage:void 0,prompts:[],temperature:1,showPromptbar:!0,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1}},78600:function(e,t,r){"use strict";r.a(e,async function(e,l){try{var a=r(85893),n=r(67294),s=r(33299),o=r(88767),i=r(61162),d=r(9008),c=r.n(d),u=r(81058),m=r(96711),x=r(1652),p=r(79913),f=r(64689),h=r(62716),v=r(76921),g=r(36686),b=r(49089),y=r(41910),j=r(5782),w=r(71054),k=r(76262),N=r(70185),C=r(88990),S=r(45928),I=r(57632),E=r(59227),Z=r(11163),P=r.n(Z),_=e([j]);j=(_.then?(await _)():_)[0];let O=e=>{let{serverSideApiKeyIsSet:t,serverSidePluginKeysSet:r,defaultModelId:l}=e,{t:d}=(0,i.$G)("chat"),{getModels:Z}=(0,x.Z)(),{getModelsError:_}=(0,m.Z)(),[O,T]=(0,n.useState)(!0),{data:L,status:D}=(0,s.useSession)();(0,E.Z)();let A=(0,u.L)({initialState:S.E}),{state:{apiKey:z,lightMode:G,folders:K,conversations:R,selectedConversation:M,prompts:U,temperature:J},dispatch:$}=A,F=(0,n.useRef)(!1),{data:H,error:B,refetch:Y}=(0,o.useQuery)(["GetModels",z,t],e=>{let{signal:r}=e;return z||t?Z({key:z},r):null},{enabled:!0,refetchOnMount:!1});(0,n.useEffect)(()=>{"unauthenticated"===D&&P().push("/signin")},[D]),(0,n.useEffect)(()=>{H&&$({field:"models",value:H})},[H,$]),(0,n.useEffect)(()=>{$({field:"modelError",value:_(B)})},[$,B,_]);let W=e=>{$({field:"selectedConversation",value:e}),(0,h.m7)(e)},V=(e,t)=>{let r={id:(0,I.Z)(),name:e,type:t},l=[...K,r];$({field:"folders",value:l}),(0,v._)(l)},q=e=>{let t=K.filter(t=>t.id!==e);$({field:"folders",value:t}),(0,v._)(t);let r=R.map(t=>t.folderId===e?{...t,folderId:null}:t);$({field:"conversations",value:r}),(0,h.fB)(r);let l=U.map(t=>t.folderId===e?{...t,folderId:null}:t);$({field:"prompts",value:l}),(0,g.V)(l)},X=(e,t)=>{let r=K.map(r=>r.id===e?{...r,name:t}:r);$({field:"folders",value:r}),(0,v._)(r)},Q=()=>{var e;let t=R[R.length-1],r={id:(0,I.Z)(),name:d("New Conversation"),messages:[],model:(null==t?void 0:t.model)||{id:y.MU[l].id,name:y.MU[l].name,maxLength:y.MU[l].maxLength,tokenLimit:y.MU[l].tokenLimit},prompt:f.cl,temperature:null!==(e=null==t?void 0:t.temperature)&&void 0!==e?e:f.Ar,folderId:null},a=[...R,r];$({field:"selectedConversation",value:r}),$({field:"conversations",value:a}),(0,h.m7)(r),(0,h.fB)(a),$({field:"loading",value:!1})},ee=(e,t)=>{let r={...e,[t.key]:t.value},{single:l,all:a}=(0,h.X1)(r,R);$({field:"selectedConversation",value:l}),$({field:"conversations",value:a})};return(0,n.useEffect)(()=>{window.innerWidth<640&&$({field:"showChatbar",value:!1})},[M]),(0,n.useEffect)(()=>{l&&$({field:"defaultModelId",value:l}),t&&$({field:"serverSideApiKeyIsSet",value:t}),r&&$({field:"serverSidePluginKeysSet",value:r})},[l,t,r]),(0,n.useEffect)(()=>{if("authenticated"!==D)return;let e=(0,b.G)();e.theme&&$({field:"lightMode",value:e.theme});let a=localStorage.getItem("apiKey");t?($({field:"apiKey",value:""}),localStorage.removeItem("apiKey")):a&&$({field:"apiKey",value:a});let n=localStorage.getItem("pluginKeys");r?($({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys")):n&&$({field:"pluginKeys",value:n}),window.innerWidth<640&&($({field:"showChatbar",value:!1}),$({field:"showPromptbar",value:!1}));let s=localStorage.getItem("showChatbar");s&&$({field:"showChatbar",value:"true"===s});let o=localStorage.getItem("showPromptbar");o&&$({field:"showPromptbar",value:"true"===o});let i=localStorage.getItem("folders");i&&$({field:"folders",value:JSON.parse(i)});let c=localStorage.getItem("prompts");c&&$({field:"prompts",value:JSON.parse(c)});let u=localStorage.getItem("conversationHistory");if(u){let e=JSON.parse(u),t=(0,p.m)(e);$({field:"conversations",value:t})}let m=localStorage.getItem("selectedConversation");if(m){let e=JSON.parse(m),t=(0,p.$)(e);$({field:"selectedConversation",value:t})}else{var x;let e=R[R.length-1];$({field:"selectedConversation",value:{id:(0,I.Z)(),name:d("New Conversation"),messages:[],model:y.MU[l],prompt:f.cl,temperature:null!==(x=null==e?void 0:e.temperature)&&void 0!==x?x:f.Ar,folderId:null}})}},[l,$,t,r,D]),(0,a.jsxs)(C.Z.Provider,{value:{...A,handleNewConversation:Q,handleCreateFolder:V,handleDeleteFolder:q,handleUpdateFolder:X,handleSelectConversation:W,handleUpdateConversation:ee},children:[(0,a.jsxs)(c(),{children:[(0,a.jsx)("title",{children:"Chatbot UI"}),(0,a.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,a.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),M&&(0,a.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(G),children:[(0,a.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,a.jsx)(k.w,{selectedConversation:M,onNewConversation:Q})}),(0,a.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,a.jsx)(w.W,{}),(0,a.jsx)("div",{className:"flex flex-1",children:(0,a.jsx)(j.e,{stopConversationRef:F})}),(0,a.jsx)(N.Z,{})]})]})]})};t.Z=O,l()}catch(e){l(e)}})},74322:function(e,t,r){"use strict";r.a(e,async function(e,l){try{r.d(t,{Z:function(){return a.Z}});var a=r(78600),n=e([a]);a=(n.then?(await n)():n)[0],l()}catch(e){l(e)}})},42603:function(e,t,r){"use strict";r.a(e,async function(e,l){try{r.r(t),r.d(t,{__N_SSP:function(){return s},default:function(){return a.Z}});var a=r(74322),n=e([a]);a=(n.then?(await n)():n)[0];var s=!0;l()}catch(e){l(e)}})},96711:function(e,t,r){"use strict";var l=r(67294),a=r(61162);let n=()=>{let{t:e}=(0,a.$G)("chat");return{getModelsError:(0,l.useMemo)(()=>t=>t?{title:e("Error fetching models."),code:t.status||"unknown",messageLines:t.statusText?[t.statusText]:[e("Make sure your OpenAI API key is set in the bottom left of the sidebar."),e("If you completed this step, OpenAI may be experiencing issues.")]}:null,[e])}};t.Z=n},1652:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});var l=r(67294);let a=()=>{let e=async(e,t,r)=>{let l=(null==t?void 0:t.params)?"".concat(e).concat(t.params):e,a=(null==t?void 0:t.body)?t.body instanceof FormData?{...t,body:t.body}:{...t,body:JSON.stringify(t.body)}:t,n={...(null==t?void 0:t.headers)?t.headers:(null==t?void 0:t.body)&&t.body instanceof FormData?{}:{"Content-type":"application/json"}};return fetch(l,{...a,headers:n,signal:r}).then(e=>{if(!e.ok)throw e;let t=e.headers.get("content-type"),r=e.headers.get("content-disposition");e.headers;let l=t&&((null==t?void 0:t.indexOf("application/json"))!==-1||(null==t?void 0:t.indexOf("text/plain"))!==-1)?e.json():(null==r?void 0:r.indexOf("attachment"))!==-1?e.blob():e;return l}).catch(async e=>{let t=e.headers.get("content-type"),r=t&&(null==t?void 0:t.indexOf("application/problem+json"))!==-1?await e.json():e;throw r})};return{get:async(t,r)=>e(t,{...r,method:"get"}),post:async(t,r)=>e(t,{...r,method:"post"}),put:async(t,r)=>e(t,{...r,method:"put"}),patch:async(t,r)=>e(t,{...r,method:"patch"}),delete:async(t,r)=>e(t,{...r,method:"delete"})}},n=()=>{let e=a(),t=(0,l.useCallback)((t,r)=>e.post("/api/models",{body:{key:t.key},headers:{"Content-Type":"application/json"},signal:r}),[e]);return{getModels:t}};var s=n},41910:function(e,t,r){"use strict";r.d(t,{MU:function(){return s},bm:function(){return a}});var l,a,n=r(64689);(l=a||(a={})).GPT_3_5="gpt-3.5-turbo",l.GPT_3_5_AZ="gpt-35-turbo",l.GPT_4="gpt-4-turbo",l.GPT_4_32K="gpt-4","azure"===n.dN?a.GPT_3_5_AZ:a.GPT_3_5;let s={[a.GPT_3_5]:{id:a.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4097,messageTokens:4},[a.GPT_3_5_AZ]:{id:a.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4097,messageTokens:4},[a.GPT_4]:{id:a.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8192,messageTokens:3},[a.GPT_4_32K]:{id:a.GPT_4_32K,name:"GPT-4",maxLength:24e3,tokenLimit:8192,messageTokens:3}}},2403:function(e,t,r){"use strict";var l,a;r.d(t,{PO:function(){return l},xN:function(){return s}}),(l||(l={})).GOOGLE_SEARCH="google-search",(a||(a={})).GOOGLE_SEARCH="Google Search";let n={[l.GOOGLE_SEARCH]:{id:l.GOOGLE_SEARCH,name:a.GOOGLE_SEARCH,requiredKeys:[{key:"GOOGLE_API_KEY",value:""},{key:"GOOGLE_CSE_ID",value:""}]}},s=Object.values(n)},17172:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});var l=r(2403);let a=e=>e&&e.id===l.PO.GOOGLE_SEARCH?"api/google":"api/chat"},79913:function(e,t,r){"use strict";r.d(t,{$:function(){return n},m:function(){return s}});var l=r(41910),a=r(64689);let n=e=>{let t=e;return t.model||(t={...t,model:t.model||"azure"===a.dN?l.MU[l.bm.GPT_3_5_AZ]:l.MU[l.bm.GPT_3_5]}),t.prompt||(t={...t,prompt:t.prompt||a.cl}),t.temperature||(t={...t,temperature:t.temperature||a.Ar}),t.folderId||(t={...t,folderId:t.folderId||null}),t.messages||(t={...t,messages:t.messages||[]}),t},s=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model="azure"===a.dN?l.MU[l.bm.GPT_3_5_AZ]:l.MU[l.bm.GPT_3_5]),t.prompt||(t.prompt=a.cl),t.temperature||(t.temperature=a.Ar),t.folderId||(t.folderId=null),t.messages||(t.messages=[]),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[])},64689:function(e,t,r){"use strict";r.d(t,{Ar:function(){return n},cl:function(){return a},dN:function(){return s}});var l=r(83454);let a=l.env.NEXT_PUBLIC_DEFAULT_SYSTEM_PROMPT||"You are a friendly, helpful AI assistant. Be concise.";l.env.OPENAI_API_HOST;let n=parseFloat(l.env.NEXT_PUBLIC_DEFAULT_TEMPERATURE||"0.5"),s=l.env.OPENAI_API_TYPE||"openai";l.env.OPENAI_API_VERSION,l.env.OPENAI_ORGANIZATION,l.env.AZURE_DEPLOYMENT_ID},62716:function(e,t,r){"use strict";r.d(t,{X1:function(){return l},fB:function(){return n},m7:function(){return a}});let l=(e,t)=>{let r=t.map(t=>t.id===e.id?e:t);return a(e),n(r),{single:e,all:r}},a=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},n=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))}},76921:function(e,t,r){"use strict";r.d(t,{_:function(){return l}});let l=e=>{localStorage.setItem("folders",JSON.stringify(e))}},36686:function(e,t,r){"use strict";r.d(t,{V:function(){return l}});let l=e=>{localStorage.setItem("prompts",JSON.stringify(e))}},49089:function(e,t,r){"use strict";r.d(t,{G:function(){return l}});let l=()=>{let e={theme:"dark"},t=localStorage.getItem("settings");if(t)try{let r=JSON.parse(t);e=Object.assign(e,r)}catch(e){console.error(e)}return e}},97450:function(e,t,r){"use strict";function l(e,t){let r,l;return function(){for(var a=arguments.length,n=Array(a),s=0;s<a;s++)n[s]=arguments[s];l?(clearTimeout(r),r=setTimeout(()=>{Date.now()-l>=t&&(e(...n),l=Date.now())},t-(Date.now()-l))):(e(...n),l=Date.now())}}r.d(t,{P:function(){return l}})}},function(e){e.O(0,[876,879,386,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);